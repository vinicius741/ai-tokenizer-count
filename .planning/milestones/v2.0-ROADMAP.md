# Milestone v2.0: Web UI

**Status:** ✅ SHIPPED 2026-01-24
**Phases:** 4-9
**Total Plans:** 27

## Overview

Add a React + shadcn/ui web interface for EPUB processing, data visualization, and token budget calculator. Users can process EPUBs from the UI with real-time progress streaming, upload existing results.json files, view rich visualizations, and calculate token budgets for cost planning.

## Phases

### Phase 4: Foundation & Project Setup

**Goal**: Working React + Vite + shadcn/ui frontend and Fastify backend with shared business logic layer
**Depends on**: Phase 3 (v1.0 CLI)
**Plans**: 4 plans

Plans:
- [x] 04-01-PLAN.md — Frontend scaffolding with Vite + React + TypeScript
- [x] 04-02-PLAN.md — shadcn/ui installation and theme configuration
- [x] 04-03-PLAN.md — Backend server scaffolding with Fastify
- [x] 04-04-PLAN.md — TypeScript shared package configuration

**Completed**: 2026-01-23

**Details:**

**Requirements**: SETUP-01, SETUP-02, SETUP-03, SETUP-04, SETUP-05, SETUP-06

**Success Criteria** (what must be TRUE):
1. User can visit http://localhost:5173 and see the React app load with shadcn/ui components styled
2. User can visit http://localhost:8787/api/health and receive {"status":"ok"} response
3. Frontend can successfully call backend API without CORS errors
4. Shared TypeScript types can be imported by both frontend and backend without build errors
5. npm run build compiles both frontend and backend without errors

---

### Phase 5: Backend API & File Processing

**Goal**: Fastify server with EPUB processing endpoints, SSE progress streaming, and security hardening
**Depends on**: Phase 4
**Plans**: 5 plans

Plans:
- [x] 05-01-PLAN.md — GET /api/list-models endpoint returning available tokenizers
- [x] 05-02-PLAN.md — In-memory job queue for background EPUB processing
- [x] 05-03-PLAN.md — POST /api/process endpoint with path validation and security
- [x] 05-04-PLAN.md — Server-Sent Events (SSE) /api/sse/:jobId for real-time progress
- [x] 05-05-PLAN.md — Job status query endpoint and results.json upload validation

**Completed**: 2026-01-23

**Details:**

**Requirements**: API-01, API-02, API-03, API-04, API-05, API-06, API-07

**Success Criteria** (what must be TRUE):
1. User can POST to /api/process with EPUB folder path and tokenizer list, receiving job ID immediately
2. User can subscribe to SSE endpoint and receive real-time progress updates (current EPUB, percentage)
3. User can upload results.json via POST /api/upload-results and have it validated for schema correctness
4. Server rejects path traversal attempts (e.g., "../../etc/passwd") with 400 error
5. Processing continues in background even if client disconnects from SSE

---

### Phase 6: File Upload & Tokenizer Selection

**Goal**: Frontend interfaces for file upload, tokenizer selection, and real-time processing feedback
**Depends on**: Phase 5
**Plans**: 5 plans

Plans:
- [x] 06-01-PLAN.md — Tokenizer selection interface (ToggleGroup chips, HF model combobox, model info cards, localStorage)
- [x] 06-02-PLAN.md — File upload components (drag-drop zone, file picker, schema validation, toasts)
- [x] 06-03-PLAN.md — EPUB folder input and process button (conditional enable, API integration)
- [x] 06-04-PLAN.md — Real-time progress display with SSE integration (striped progress bar, ETA, completion transformation)
- [x] 06-05-PLAN.md — Cancel processing and localStorage persistence (abort controller, reset button, state management)

**Completed**: 2026-01-23
**Verification**: All 17 requirements verified (06-VERIFICATION.md)

**Details:**

**Requirements**: TOKEN-01, TOKEN-02, TOKEN-03, TOKEN-04, TOKEN-05, TOKEN-06, TOKEN-07, UPLOAD-01, UPLOAD-02, UPLOAD-03, UPLOAD-04, UPLOAD-05, UPLOAD-06, UPLOAD-07, UPLOAD-08, UPLOAD-09, UPLOAD-10

**Success Criteria** (what must be TRUE):
1. User can drag-and-drop results.json file and see it validated and loaded
2. User can select GPT-4 and Claude tokenizers via checkboxes (both default selected)
3. User can search Hugging Face models via combobox and see model info cards
4. User can input EPUB folder path and click "Process" to start processing
5. User sees real-time progress bar with current/total EPUBs and per-EPUB status updates
6. User can click "Cancel" button and see processing stop within 2 seconds
7. Last selected tokenizers are remembered in localStorage and restored on page load

---

### Phase 7: Data Visualization & Comparison

**Goal**: Interactive charts (bar, scatter, results table) with multi-tokenizer comparison
**Depends on**: Phase 6
**Plans**: 5 plans

Plans:
- [x] 07-01-PLAN.md — Bar chart with token counts per EPUB (sortable, color-coded, custom tooltips)
- [x] 07-02-PLAN.md — Scatter plot with word vs token density and trend line (all tokenizers on same plot, zoom/pan)
- [x] 07-03-PLAN.md — Results table with sorting, filtering, and CSV export (TanStack Table, range slider)
- [x] 07-04-PLAN.md — Multi-tokenizer comparison heatmap with percentage differences
- [x] 07-05-PLAN.md — Side-by-side comparison bar chart (grouped bars per EPUB, tokenizer comparison)

**Completed**: 2026-01-24
**Verification**: All 23 must-haves verified (07-VERIFICATION.md)

**Details:**

**Requirements**: VIS-01, VIS-02, VIS-03, VIS-04, VIS-05, VIS-06, VIS-07, VIS-08, VIS-09, VIS-10, VIS-11, VIS-12, COMP-01, COMP-02, COMP-03, COMP-04

**Success Criteria** (what must be TRUE):
1. User sees bar chart showing token counts per EPUB with color-coded bars by tokenizer
2. User can click bar chart to sort by token count (ascending/descending)
3. User sees scatter plot showing word count vs token count with trend line
4. User can hover over any chart element to see tooltip with exact counts and metadata
5. User sees results table with columns for Title, Author, Words, Tokens, File Path
6. User can sort table by any column and filter by title/author text search
7. User can export results table and comparison table to CSV
8. User sees side-by-side comparison chart showing percentage differences between tokenizers

---

### Phase 8: Token Budget Calculator & Cost Estimation

**Goal**: Token budget calculator with optimization strategies and cost estimation display
**Depends on**: Phase 7
**Plans**: 4 plans

Plans:
- [x] 08-01-PLAN.md — Budget calculator form (input, presets, tokenizer selection, strategy tabs)
- [x] 08-02-PLAN.md — Knapsack solver algorithm for book selection (max books, max words, balanced)
- [x] 08-03-PLAN.md — Budget display UI (selected books, progress bar, copy/JSON export)
- [x] 08-04-PLAN.md — Cost estimation display per provider (OpenAI, Anthropic, Google)

**Completed**: 2026-01-24
**Verification**: All 7 must-haves verified (08-VERIFICATION.md)

**Details:**

**Requirements**: BUDGET-01, BUDGET-02, BUDGET-03, BUDGET-04, BUDGET-05, BUDGET-06, BUDGET-07, BUDGET-08, BUDGET-09, BUDGET-10, BUDGET-11, BUDGET-12, COST-01, COST-02, COST-03, COST-04

**Success Criteria** (what must be TRUE):
1. User can input token budget number or select preset (32K, 128K, 200K)
2. User can select tokenizer and optimization strategy (max books, max words, balanced)
3. User sees selected books list with total tokens used and remaining tokens
4. User can copy book list to clipboard or download as JSON
5. User sees estimated dollar cost per provider (OpenAI, Anthropic, Google)
6. Calculator shows error if budget is insufficient for at least one book
7. Budget calculator state is saved to localStorage and restored on page load

---

### Phase 9: Polish, Persistence & Responsive Design

**Goal**: Session persistence, responsive layout, error boundaries, and UX polish
**Depends on**: Phase 8
**Plans**: 4 plans

Plans:
- [x] 09-01-PLAN.md — Session persistence (localStorage save/restore, new session)
- [x] 09-02-PLAN.md — Responsive layout (desktop, tablet, mobile breakpoints)
- [x] 09-03-PLAN.md — Loading states (skeleton screens, button spinners)
- [x] 09-04-PLAN.md — Error boundaries and error handling (toasts, friendly messages)

**Completed**: 2026-01-24
**Verification**: All 15 must-haves verified (09-VERIFICATION.md)

**Details:**

**Requirements**: PERSIST-01, PERSIST-02, PERSIST-03, PERSIST-04, RESP-01, RESP-02, RESP-03, RESP-04, UX-01, UX-02, UX-03, UX-04, UX-05, UX-06

**Success Criteria** (what must be TRUE):
1. UI shows prompt to restore saved results on page load if previous session exists
2. User can click "New Session" button to clear all saved data
3. Layout works on desktop (1024px+) with side-by-side charts and table
4. Layout works on tablet (768px-1024px) with stacked layout
5. Layout works on mobile (<768px) with single column and horizontal scroll for charts
6. User sees skeleton screens during data fetch and loading spinners on buttons
7. Error boundaries catch component errors and show friendly message with retry button
8. All buttons have minimum 44x44px touch targets

---

## Milestone Summary

**Delivered Features:**
- React + Vite + shadcn/ui frontend with zinc theme
- Fastify backend server with CORS and SSE support
- Shared TypeScript package with dual CJS/ESM builds
- Real-time EPUB processing with progress streaming
- File upload (drag-drop zone, file picker, schema validation)
- Tokenizer selection interface (GPT-4, Claude, HF models) with localStorage persistence
- 5 visualization types (bar chart, scatter plot, results table, heatmap, comparison chart)
- Token budget calculator with 3 knapsack optimization strategies
- Cost estimation for OpenAI, Anthropic, Google with quarterly pricing updates
- Session persistence with restore dialog and new session button
- Responsive design for desktop (1024px+), tablet (768-1024px), mobile (<768px)
- Error boundaries, loading states (skeletons, spinners), toast notifications
- CSV export for results table and comparison table
- JSON export for budget calculator selected books

**Key Decisions:**
- React + shadcn/ui frontend with Fastify backend for modern stack and TypeScript support
- npm workspaces with shared package instead of Turborepo for simplicity
- SSE instead of WebSockets for simpler unidirectional progress streaming
- In-memory job queue instead of BullMQ/Redis for localhost-only app
- Server-side file system storage instead of database for simpler deployment
- No authentication for localhost-only access
- TanStack Table instead of AG Grid for headless control
- Recharts for charts with built-in trend line support
- Knapsack algorithms (O(n log n)) for budget optimization
- Quarterly pricing update schedule with metadata tracking

**Issues Resolved:**
- API contract mismatch between ProcessButton and backend (field naming: inputPath/tokenizerList → path/tokenizers)
- SSE field naming mismatch (filename → fileName)
- TypeScript type import errors with verbatimModuleSyntax
- Fastify plugin pattern for route registration
- Schema validation without external dependencies (manual type checking)

**Technical Debt:**
- Optional: Add loading state to FileDropzone during validation
- Optional: Add confirmation dialog to NewSessionButton
- Optional: Add initial load indicator to useLocalStorage hook
- Backend POST /api/cancel/:jobId endpoint may not exist (frontend handles gracefully)
- Chart library testing with 1000+ EPUB dataset not yet done

**Decimal Phases:**
None

---

_For current project status, see .planning/ROADMAP.md_

---
