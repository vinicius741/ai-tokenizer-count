---
phase: 01-epub-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - tsconfig.json
  - src/cli/index.ts
  - src/file-discovery/scanner.ts
  - .gitignore
autonomous: true

must_haves:
  truths:
    - "User can install dependencies with npm install"
    - "User can run TypeScript compilation without errors"
    - "Tool can discover .epub files in a directory (flat scan)"
    - "Tool can discover .epub files recursively when --recursive flag is used"
    - "Tool skips hidden files/folders (names starting with .)"
    - "./epubs/ folder is gitignored"
  artifacts:
    - path: "package.json"
      provides: "Project dependencies and scripts"
      contains: "@gxl/epub-parser, commander, cli-table3"
    - path: "tsconfig.json"
      provides: "TypeScript compilation configuration"
      contains: "target, module, outDir"
    - path: "src/cli/index.ts"
      provides: "CLI entry point"
      min_lines: 10
    - path: "src/file-discovery/scanner.ts"
      provides: "EPUB file discovery functions"
      exports: ["discoverEpubFiles", "FileDiscoveryOptions"]
    - path: ".gitignore"
      provides: "Git ignore patterns"
      contains: "./epubs/"
  key_links:
    - from: "src/file-discovery/scanner.ts"
      to: "fs.readdir"
      via: "Node.js built-in fs module"
      pattern: "fs\\.readdir"
    - from: "src/file-discovery/scanner.ts"
      to: "file extension filter"
      via: "path.extname() with case-insensitive .epub check"
      pattern: "\\.toLowerCase\\(\\)\\.endsWith\\('\\.epub'\\)"
---

<objective>
Initialize the Node.js/TypeScript project with proper package configuration, TypeScript setup, directory structure, and EPUB file discovery functionality.

Purpose: Establish the foundation for all subsequent development by setting up the project build system and creating the file discovery logic that will feed EPUB files to the processing pipeline.

Output: Working npm project with TypeScript compilation, file discovery functions for flat and recursive EPUB scanning, and proper .gitignore configuration.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-epub-foundation/01-CONTEXT.md
@.planning/phases/01-epub-foundation/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Initialize Node.js/TypeScript project structure</name>
  <files>package.json, tsconfig.json, src/cli/index.ts, src/epub/parser.ts, src/epub/text.ts, src/output/table.ts, src/output/markdown.ts, src/errors/handler.ts</files>
  <action>
Create package.json with:
- name: "epub-tokenizer-counter"
- version: "1.0.0"
- type: "module" (ES modules)
- dependencies: @gxl/epub-parser@^2.0.4, commander@^12.0.0, cli-table3@^0.6.3
- devDependencies: @types/node@^22.0.0, typescript@^5.6.0
- scripts: "build": "tsc", "start": "node dist/cli/index.js"

Create tsconfig.json with:
- target: "ES2022"
- module: "NodeNext"
- moduleResolution: "NodeNext"
- outDir: "./dist"
- rootDir: "./src"
- strict: true
- esModuleInterop: true
- skipLibCheck: true

Create directory structure with placeholder files:
- src/cli/index.ts (empty export for now)
- src/epub/parser.ts (empty export)
- src/epub/text.ts (empty export)
- src/output/table.ts (empty export)
- src/output/markdown.ts (empty export)
- src/errors/handler.ts (empty export)

DO NOT use any CLI generator — create these files manually to ensure clean structure.
  </action>
  <verify>Run `npm install` and `npm run build` — both should complete without errors</verify>
  <done>package.json and tsconfig.json exist with correct configuration, TypeScript compiles successfully with no entry point errors (placeholder files ignore this), dependencies installable via npm install</done>
</task>

<task type="auto">
  <name>Task 2: Implement EPUB file discovery scanner</name>
  <files>src/file-discovery/scanner.ts</files>
  <action>
Create src/file-discovery/scanner.ts with:

1. Export interface FileDiscoveryOptions:
   - recursive: boolean (default false)
   - includeHidden: boolean (default false — skip files/folders starting with .)

2. Export async function discoverEpubFiles(inputPath: string, options: FileDiscoveryOptions): Promise<string[]>
   - Check if inputPath is file or directory using fs.stat()
   - If file: return single-element array if .epub extension (case-insensitive), empty array otherwise
   - If directory:
     - Use fs.readdir() with { withFileTypes: true, recursive: options.recursive }
     - Filter out hidden files/folders if !includeHidden (entry.name.startsWith('.'))
     - Filter files ending in .epub (case-insensitive: fileName.toLowerCase().endsWith('.epub'))
     - Return array of absolute file paths (path.join(inputPath, entry.name) for non-recursive, entry.path for recursive)

3. Handle permission errors gracefully — skip directories that can't be read, log to stderr

Follow Node.js fs.readdir with recursive option pattern from RESEARCH.md (Pattern 3).
  </action>
  <verify>Create test directory with .epub files, run `node -e "import('./dist/file-discovery/scanner.js').then(m => m.discoverEpubFiles('./test-dir', {recursive: false}).then(console.log))"` — should return array of .epub file paths</verify>
  <done>discoverEpubFiles() returns array of .epub file paths, skips hidden files by default, respects recursive flag, case-insensitive extension matching</done>
</task>

<task type="auto">
  <name>Task 3: Update .gitignore for epubs folder</name>
  <files>.gitignore</files>
  <action>
Append to existing .gitignore:
- Line: "./epubs/" (default input folder per CFG-01, CFG-03)
- Line: "./output/" (default output folder per CONTEXT.md decision)
- Line: "dist/" (TypeScript compilation output)
- Line: "node_modules/" (npm dependencies)

Keep existing .planning/intel/ entry from GSD hooks.
  </action>
  <verify>Run `git status` — should not show node_modules/, dist/, epubs/, or output/ as untracked if they exist</verify>
  <done>.gitignore includes ./epubs/, ./output/, dist/, and node_modules/ patterns</done>
</task>

</tasks>

<verification>
After completing all tasks:
1. `npm install` succeeds without errors
2. `npm run build` compiles TypeScript to dist/ directory
3. TypeScript emits .js and .d.ts files for all source files
4. .gitignore properly excludes build artifacts and data directories
</verification>

<success_criteria>
1. User can run `npm install && npm run build` without errors
2. TypeScript compilation produces dist/ directory with compiled JavaScript
3. discoverEpubFiles() function correctly finds .epub files in test scenarios
4. Hidden files/folders are skipped by default
5. Recursive scanning respects the options.recursive flag
6. .gitignore prevents epubs/, output/, dist/, and node_modules/ from being committed
</success_criteria>

<output>
After completion, create `.planning/phases/01-epub-foundation/01-01-SUMMARY.md`
</output>
