---
phase: 08-token-budget-calculator
plan: 04
type: execute
wave: 3
depends_on: ["08-03"]
files_modified:
  - web/src/components/budget/CostEstimationCards.tsx
  - web/src/components/budget/BudgetCalculator.tsx
  - web/src/lib/pricing-data.ts
autonomous: false

must_haves:
  truths:
    - "User sees cost estimation cards for three providers (OpenAI, Anthropic, Google)"
    - "Each provider card shows provider name, estimated cost, and price per 1M tokens"
    - "User sees input-only cost (EPUB processing assumes all tokens are input)"
    - "User can click link to view official provider pricing page"
    - "Footer shows 'Pricing as of 2026-01' with disclaimer"
    - "Costs are calculated based on selected book tokens, not total EPUB tokens"
  artifacts:
    - path: "web/src/components/budget/CostEstimationCards.tsx"
      provides: "Provider cost cards with pricing display and links"
      min_lines: 80
      exports: ["CostEstimationCards"]
    - path: "web/src/lib/pricing-data.ts"
      provides: "Provider pricing constants with metadata (lastUpdated, nextReview)"
      min_lines: 70
      exports: ["PROVIDER_PRICING", "PRICING_METADATA", "getAllCostEstimates"]
  key_links:
    - from: "web/src/components/budget/CostEstimationCards.tsx"
      to: "web/src/lib/pricing-data.ts"
      via: "Import getAllCostEstimates and PROVIDER_PRICING"
      pattern: "import.*getAllCostEstimates|import.*PROVIDER_PRICING"
    - from: "web/src/components/budget/BudgetCalculator.tsx"
      to: "web/src/components/budget/CostEstimationCards.tsx"
      via: "Import and render CostEstimationCards with totalTokens"
      pattern: "import.*CostEstimationCards|<CostEstimationCards"
    - from: "web/src/components/budget/CostEstimationCards.tsx"
      to: "PROVIDER_PRICING pricingUrl"
      via: "External link to provider pricing page"
      pattern: "pricingUrl|href=.*pricing"
---

<objective>
Implement cost estimation display with provider cards (OpenAI, Anthropic, Google) showing estimated processing costs for selected books.

**Purpose:** After users select EPUBs within their budget, they need to understand the dollar cost of processing those books with different LLM providers. Cost estimation cards display the calculated cost per provider based on the selected book token count, enabling users to compare providers and choose the most cost-effective option for their use case.

**Output:** Working cost estimation display with:
- Three provider cards (OpenAI, Anthropic, Google) in grid layout
- Each card shows: provider name, total cost (formatted as currency), price per 1M input/output tokens
- External link to official provider pricing page
- Toggle or separate view for "Selected books" vs "All EPUBs" cost (optional, may skip for simplicity)
- Footer with "Pricing as of 2026-01" and disclaimer that costs are estimates
</objective>

<execution_context>
@/Users/vinicusmoreira/.claude/get-shit-done/workflows/execute-plan.md
@/Users/vinicusmoreira/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-token-budget-calculator/08-CONTEXT.md
@.planning/phases/08-token-budget-calculator/08-RESEARCH.md
@.planning/phases/08-token-budget-calculator/08-02-SUMMARY.md
@.planning/phases/08-token-budget-calculator/08-03-SUMMARY.md
@packages/shared/src/types.ts
@web/src/components/budget/BudgetCalculator.tsx
@web/src/lib/pricing-data.ts
@web/src/components/ui/card.tsx
</context>

<tasks>

<task type="auto">
  <name>Update pricing-data.ts with metadata</name>
  <files>web/src/lib/pricing-data.ts</files>
  <action>
    Update web/src/lib/pricing-data.ts to add pricing metadata:

    1. Add PRICING_METADATA constant:
       - lastUpdated: '2026-01-24'
       - nextReview: '2026-04-24'
       - source: 'Official provider pricing pages'

    2. Ensure PROVIDER_PRICING has all required fields:
       - Each provider has: name, inputPrice, outputPrice, pricingUrl
       - Verify prices are current (OpenAI: $2.50/$10, Anthropic: $3/$15, Google: $0.30/$2.50)

    3. Export PRICING_METADATA alongside existing exports

    Reference the research pattern for pricing values. Add comment that pricing should be updated quarterly.
  </action>
  <verify>
    ```bash
      grep -q "PRICING_METADATA" web/src/lib/pricing-data.ts
    ```
  </verify>
  <done>
    pricing-data.ts exports PRICING_METADATA with lastUpdated date and source information
  </done>
</task>

<task type="auto">
  <name>Create CostEstimationCards component</name>
  <files>web/src/components/budget/CostEstimationCards.tsx</files>
  <action>
    Create web/src/components/budget/CostEstimationCards.tsx:

    Props:
    - tokenCount: number (total tokens from selected books)

    Implementation:
    1. Import getAllCostEstimates and PROVIDER_PRICING from lib/pricing-data
    2. Import PRICING_METADATA for footer
    3. Import ExternalLink icon from lucide-react
    4. Import Card components from @/components/ui/card

    5. Get estimates: const estimates = getAllCostEstimates(tokenCount)

    6. Render section with:
       - Header with "Estimated Cost" heading and link to GitHub pricing page
       - Grid layout (md:grid-cols-3) for provider cards
       - For each estimate, render Card with:
         * CardHeader with CardTitle (provider name)
         * CardContent with:
           - Large bold text: ${estimate.totalCost.toFixed(4)} (4 decimal places)
           - Small muted text showing pricing:
             * ${pricePerMillion.input}/1M input tokens
             * ${pricePerMillion.output}/1M output tokens
           - Link to provider pricing page with ExternalLink icon
       - Footer disclaimer:
         * "Costs are estimates only. Actual costs may vary based on model version, region, and usage."
         * "Verify with provider before making decisions."
         * "Pricing as of 2026-01" with link to pricing source

    Use grid-cols-3 for desktop, single column on mobile. Use consistent Card styling with other components.

    Note: For EPUB processing, all tokens are input (reading text). Output costs shown but input-only cost is primary.
  </action>
  <verify>
    ```bash
      test -f web/src/components/budget/CostEstimationCards.tsx && grep -q "export.*CostEstimationCards" web/src/components/budget/CostEstimationCards.tsx
    ```
  </verify>
  <done>
    CostEstimationCards.tsx exports component displaying three provider cards with costs and pricing links
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
    Complete cost estimation display with:
    - Updated pricing-data.ts with PRICING_METADATA
    - CostEstimationCards component with three provider cards
  </what-built>
  <how-to-verify>
    1. Start dev server: npm run dev (in root) or cd web && npm run dev
    2. Upload a results.json file with multiple EPUBs
    3. Set budget and select strategy to get selected books
    4. Scroll to cost estimation section below selected books table
    5. Verify three provider cards display (OpenAI, Anthropic, Google)
    6. Verify each card shows:
       - Provider name
       - Total cost (e.g., $0.1125 for 45,000 tokens)
       - Price per 1M input/output tokens
       - Link to provider pricing page
    7. Click provider pricing links: verify they open in new tab
    8. Verify footer shows disclaimer and "Pricing as of 2026-01"
    9. Check costs are reasonable (e.g., 45K tokens * $2.50/1M = ~$0.11 for OpenAI)
    10. Check browser console for errors
  </how-to-verify>
  <resume-signal>Type "approved" if cost estimation works correctly, or describe any issues</resume-signal>
</task>

<task type="auto">
  <name>Integrate CostEstimationCards into BudgetCalculator</name>
  <files>web/src/components/budget/BudgetCalculator.tsx</files>
  <action>
    Update web/src/components/budget/BudgetCalculator.tsx to render cost estimation:

    1. Import CostEstimationCards from components/budget/CostEstimationCards

    2. In the result display section (after ExportButtons), add:
       - New section heading: "Cost Estimation"
       - Render CostEstimationCards with tokenCount={result.totalTokens}
       - Wrap in Card or section container for consistent spacing

    3. Ensure cost estimation only renders when result.selectedBooks.length > 0

    Place cost estimation after export buttons, before closing the budget calculator card.

    Reference the export buttons section for layout consistency.
  </action>
  <verify>
    ```bash
      grep -q "CostEstimationCards" web/src/components/budget/BudgetCalculator.tsx
    ```
  </verify>
  <done>
    BudgetCalculator.tsx renders CostEstimationCards after ExportButtons when selected books exist
  </done>
</task>

<task type="auto">
  <name>Add all EPUBs cost toggle (optional enhancement)</name>
  <files>web/src/components/budget/CostEstimationCards.tsx</files>
  <action>
    OPTIONAL: Add toggle to show cost for "Selected books" vs "All EPUBs":

    1. Add optional prop: allEpubsTokens?: number
    2. Add state: const [showAll, setShowAll] = useState(false)
    3. Add SegmentedControl/ToggleGroup for switching views
    4. Calculate tokenCount based on showAll state
    5. Pass tokenCount to getAllCostEstimates

    If implementing, use shadcn/ui ToggleGroup or similar component.
    If skipping, the phase still meets requirements (selected books cost is required).

    This is optional - if time/constraint suggests skipping, document decision in summary.
  </action>
  <verify>
    ```bash
      # If implemented: grep -q "showAll\|allEpubs" web/src/components/budget/CostEstimationCards.tsx
      # If skipped: this step is documented as optional in summary
    ```
  </verify>
  <done>
    CostEstimationCards optionally includes toggle for selected vs all EPUBs cost view (or skipped for simplicity)
  </done>
</task>

</tasks>

<verification>
After all tasks complete, verify:

1. pricing-data.ts exports PRICING_METADATA with lastUpdated date
2. CostEstimationCards component displays three provider cards in grid layout
3. Each provider card shows: name, total cost, input/output price per 1M tokens, pricing link
4. Costs are calculated based on selected book tokens (result.totalTokens)
5. Provider pricing links open in new tab with correct URLs
6. Footer shows disclaimer and "Pricing as of 2026-01"
7. BudgetCalculator renders CostEstimationCards after ExportButtons
8. Cost estimation only displays when selected books exist
9. Costs are formatted correctly with 4 decimal places (e.g., $0.1125)
10. No console errors when viewing cost estimation
</verification>

<success_criteria>
1. User sees three provider cards (OpenAI, Anthropic, Google) with calculated costs
2. Each card shows accurate cost based on selected book token count
3. User can click external link to view official provider pricing page
4. Footer displays pricing date disclaimer and estimate disclaimer
5. Cost estimation renders in correct position (after selected books table)
6. Cost calculations are accurate (e.g., 45,000 tokens * $2.50/1M = ~$0.11 for OpenAI)
7. No console errors when viewing cost estimation display
</success_criteria>

<output>
After completion, create `.planning/phases/08-token-budget-calculator/08-04-SUMMARY.md` with summary of implementation
</output>
